---
import TimelineLayout from "../layouts/TimelineLayout.astro";
import { getSlugFromFilePath } from "../utils/blog";

export async function getStaticPaths() {
    const blogPostModules = import.meta.glob("../data/blog/*.md");

    const blogPosts = await Promise.all(
        Object.entries(blogPostModules).map(async ([path, loader]) => {
            const post = (await loader()) as Record<string, any>;
            return { ...post, file: path } as any;
        }),
    );

    return blogPosts.map((post) => {
        const slug = getSlugFromFilePath(post.file);
        return {
            params: { slug },
            props: { post },
        };
    });
}

const { post } = Astro.props;
const { Content, frontmatter } = post;
---

<TimelineLayout frontmatter={frontmatter}>
    <Content />
</TimelineLayout>
